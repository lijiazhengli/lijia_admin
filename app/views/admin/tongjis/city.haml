%h2 订单地址统计
%h5 说明
%p 1. 查询结果，不包含取消订单
%p 2.产品sku： 多个产品sku请用英文逗号分割。此条件为包含关系查询，即当输入'3,25'时，查询的是第51期职业整理师训练营（沈阳站）课程和有透明抽屉柜的订单
= render :partial => '/admin/orders/search', :locals => {url: city_admin_tongjis_path, order_list: true}

%div
  总数： 
  = @orders.try(:total_count) || 0
.table-responsive
  %table.table.table-striped.table-sm
    %thead
      %tr
        %th 单号
        %th 订购人
        %th 产品信息
        %th 省
        %th 市
        %th 区
        %th 地址
        %th 小区
        %th 推荐人
        %th 组织人
        %th 费用
        %th 状态
        %th 创建时间
    %tbody
      - @orders.each do |item|
        %tr
          %td= link_to item.external_id, admin_order_path(item)
          %td= @users_hash[item.user_id]
          %td
            - item.purchased_items.each do |sub_item|
              - product = @product_hash[sub_item.product_id]
              - if product
                - if item.order_type == Order::PRODUCT_ORDER
                  %div #{product[:title]}x#{sub_item.quantity}
                - else
                  %div #{product[:title]}
          %td= item.address_province
          %td= item.address_city
          %td= item.address_district
          %td= item.location_title
          %td= item.location_details
          %td= show_referral_info(item, {})
          %td= show_organizer_info(item, {})
          %td= @order_payment_records.select{|r| r.order_id == item.id}.map(&:cost).map(&:to_f).reduce(0, :+).round(2)   
          %td= Order::STATUS[item.status]
          %td= item.created_at.strftime('%F %T')        
  - if @orders.present?  
    = paginate @orders
